# Урок 1.1: Акторы и `ActorSystem`

С почином! Добро пожаловать на урок №1.

На этом уроке вы сможете создать ваших первых акторов и познакомитесь с основами [Akka.NET](http://getakka.net/).

## Ключевые идеи / общая информация

Во время этого урока вы получите практический опыт работы с акторами, в консопльном приложение. Для этого вы создадине систему акторов и несолько акторов в рамках этой системы. 

Мы напишем двух акторов, один з которых будет читать из консоли, а другой писать в консоль после небольшой обработки данных.

### Что такое актор?

"Актор" это просто аналог человека, выполняющего какую-то роль в системе. Этот человек является сущностью, объектом, и может проводить какие-то действия и общаться с другими людьми.

> Мы предполагаем, что вам знакомы идеи объектно ориентированного программирования (ООП).  Модель акторов очень похожа на объектно ориентированную модель - в рамках ООП все является объектами, в рамках модели акторов ***все является актором***.

Повторяйте про себя: все является актором. Все является актором. Все является актором! Представьте вашу систему как иерархию людей, в которой задачи разбиваются на части и делегируются до тех пор, пока не станут достаточно маленьким для того, чтобы быть качественно выоплненными даже одним актором.


На данный момент мы подоздерваем что вы думаете примерно так : в рамках ООП вы стараетесь дать каждому объекту простую и четко определенную цель существования. В принципе, система акторов ничем не отличается, за исключением того, что четкая цель теперь в зоне ответственности актором.

**Дополнительный материал: [Что такое актор в рамках Akka.NET](http://petabridge.com/blog/akkadotnet-what-is-an-actor/)?**

### How do actors communicate?
### Как акторы общаются?

Акторы общаются друг с другом точно так же, как и люди - обмениваясь сообщения. А сообщения - это старые добрые классы C#.


```csharp
//это сообщение !
public class SomeMessage{
	public int SomeValue {get; set}
}
```

Более детально мы разберем сообщения на следующем уроке, не волнуйтесь на этот счет. Все что вам надо сейчас знать, это то, что сообщения можно отправить другому актору при помощи метода `Tell()`

```csharp
//посылаем сообщение другому актору
someActorRef.Tell("и это тоже сообщение!");
```

### Что акторы могут делать?

Все что вы запрограммируюете. Серьезно :)

Вы создаете акторов, заставляете их обрабатывать сообщения, которые они получают, и акторы могут сделать все что угодно для того, тчобы обработать сообщение. Делать запросы к базе данных, писать в файл, изменять внутренние переменные, или любые другие вещи, которые могут вам понадобиться.

Помимо обработки сообщений, актор может:

1. Создавать других акторов

1. Посылать сообщения другим акторам (например отправителю текущего сообщения, используя свойство `Sender`)

1. Менять свое поведение и обрабатывать следующее полученное сообщение по-другому

Акторы по своей природе асинхронны(более подробно об этом на следующем уроке). И в [Модели акторов](https://en.wikipedia.org/wiki/Actor_model) не указано, какие из приведенных пунктов обязательны для актора, точно так же как не указан порядок, в котором эти действия следует выполнять. Все в ваших руках.

### Какие существуют типы акторов?

Все типы акторов наследуются от `UntypedActor`, но это пока не очень важно. Детальный разбор разных акторов будет чуть позже.

В блоке 1 все ваши акторы будут наследниками [`UntypedActor`](http://getakka.net/docs/Working%20with%20actors#untypedactor-api "Akka.NET - UntypedActor API").

### Как можно создать актора?

Для создания акотора необходимо знать две основные вещи:

1. Все аткоры создаются в рамках определенного контекста. 

1. При создании актора необходимо тажке создать `Props`. `Props` это объект, который инкапсулирует формулу создания определенного актора.


Подробнее о `Props` будет в третьем уроке, так что пока не особо парьтесь по этому поводу. В коде примеров вы увидите несколько `Props`, этого дложно быть достаточно для понимания, как создать актора с их помощью.


Обратите внимание, что первые аткоры будут созданы в рамках контекста вашей системы акторов. Больше деталей - в описании упражения.

### Что такое `ActorSystem` (система акторов)?


`ActorSystem` - это ссылка на систему акторов, входящую в состав Akka.NET. Все акторы живут в конексте этой системы акторов. Ваши первые акторы также будут созданы в рамках этого конекста.



Кстати, `ActorSystem`  - очень тяжеловесный объект, не создавайте более одной копии в приложении.

Поооооехали! Покончим с теорией, давайте погрузимся в код и создадим первых аткоров.


## Упражнение
Погружаемся!

> Замечание: внутри примеров кода вы увидите секции, помеченные `"YOU NEED TO FILL IN HERE"`. Вам необходимо найти такие учатки кода, и заполнить их необходимым для выполнения задания функционалом.

### Запускаеи пример fill-in-the-blank 


Перейдите в папку [DoThis](../DoThis/) и откройте [WinTail](../DoThis/WinTail.sln) в Visual Studio. Солюшен состоит из простого консольного приложения и всего лишь одного проекта Visual Studio.

Вы будете пользоваться этим солюшеном на протяжении всего первого блока.

### Устанавливаем свежую версию NuGet  пакета Akka.NET 

В консоли  Package Manager наберите следующую команду:

```
Install-Package Akka
```

Таким образом установится последйний билд Akka.NET, который вам понадобится для того, чтобы скомпилировать приложение.

После этого добавьте использование пространства имен в файж `Program.cs`:


```csharp
// in Program.cs
using Akka.Actor;
```

### Создаем первый экземпляр `ActorSystem`

Откройте файл `Program.cs` и добавьте следующие строки для того, чтобы создать первую систему акторов.

```csharp
MyActorSystem = ActorSystem.Create("MyActorSystem");
```
>
> **NOTE:** When creating `Props`, `ActorSystem`, or `ActorRef` you will very rarely see the `new` keyword. These objects must be created through the factory methods built into Akka.NET. If you're using `new` you might be making a mistake.


> **Внимание** При создании `Props`, `ActorSystem`, или `ActorRef` вы редко будете пользоваться ключевым словом `new` . Эти объекты должны создаваться только при помощи фабричных методов встроенных в Akka.NET. Пользоваться `new` - значит совершать ошибку.


### Создаем акторов для чтения и записи в консоль (ConsoleReaderActor и ConsoleWriterActor)

Классы этих акторов уже написаны, но вам необходимо создать экземпляры этих акторов.

В файле `Program.cs`,  добавьте следующие строки сразу после создания вашей `ActorSystem`:

```csharp
var consoleWriterActor = MyActorSystem.ActorOf(Props.Create(() => new ConsoleWriterActor()));
var consoleReaderActor = MyActorSystem.ActorOf(Props.Create(() => new ConsoleReaderActor(consoleWriterActor)));
```


Вот в принципе все что надо для создания актора. Подробный разбор `Props` и `ActorRef`-ов отложим до третьего урока, пока просто пользуйтесь ими по аналогии.

###  ConsoleReaderActor посылает собщение ConsoleWriterActor
Самое время заставить ваших акторов взяться за работу!

Вам понадобится следующее:


1. ConsoleReaderActor настроен на чтение из консоли. Он отсылает сообщение актору ConsoleWriterActor, в котором передает только что прочитанную с консоли информацию.

	```csharp
	// в файле ConsoleReaderActor.cs
	_consoleWriterActor.Tell(read);
	```

2. После отправки сообщения ConsoleWriterActor,  ConsoleReaderActor отправляет сообщение самому себе. Это необходимо для того, чтобы цикл чтения данных из консоли продолжался.

	```csharp
	// в файле ConsoleReaderActor.cs
	Self.Tell("continue");
	```
3. Отправляем первое сообщение актору  ConsoleReaderActor для того, чтобы начать чтение данных с консоли.

	```csharp
	// в файле Program.cs
	consoleReaderActor.Tell("start");
	```

### Шаг 5: Собираем и запускаем!
После того, как все изменения внесены нажмите `F5`, чтобы скомпилировать и запустить проект в Visual Studio.

Если все работает правильно, вы должны увидеть что-то подобно этому:
![Petabridge Akka.NET Bootcamp Lesson 1.1 Correct Output](Images/example.png)



### Когда вы закончили
Сравните ваш код с кодом, приведенным в папке [Completed](Completed/) чтобы увидеть дополнительные инструкции.


## Отличная работа! Переходим к уроку №2 !
Здорово! Поздравляем с завершением первого урока!

**Переходим к  [Уроку 2 - Создание и обработка различных типов сообщений](../lesson2).**

## Есть вопросы?
**Не стесняйтесь задавать вопроосы** :).


Можете задавать любые вопросы, большие и маленькие, [в этом чате команд Petabridge и Akka.NET (английский)](https://gitter.im/petabridge/akka-bootcamp).

### Проблемы с кодом?
Если у вас возникил проблемы с запуском кода или чем-то другим, что необходимо починить в уроке, пожалуйста, [создайте issue](https://github.com/petabridge/akka-bootcamp/issues) и мы это пофиксим. Таким образом вы поможете всем кто будет проходить эту обучалку.
